---
---
{%- assign _content = content -%}

{%- comment -%}
Komprimerer HTML men beskyttar innhaldet i <pre>, <script>, <style> og <textarea>
{%- endcomment -%}

{%- comment -%} Beskytt <script> taggar fyrst {%- endcomment -%}
{%- assign _script_parts = _content | split: "<script" -%}
{%- assign _protected_content = "" -%}

{%- for _part in _script_parts -%}
  {%- if forloop.first -%}
    {%- comment -%} Komprimér alt før fyrste <script> {%- endcomment -%}
    {%- assign _compressed = _part | replace: '    ', ' ' | replace: '   ', ' ' | replace: '  ', ' ' -%}
    {%- assign _compressed = _compressed | replace: '> <', '><' | strip_newlines -%}
    {%- assign _protected_content = _protected_content | append: _compressed -%}
  {%- else -%}
    {%- comment -%} Del opp på </script> {%- endcomment -%}
    {%- assign _script_split = _part | split: "</script>" -%}
    {%- if _script_split.size > 1 -%}
      {%- comment -%} Bevar innhaldet i <script> taggen {%- endcomment -%}
      {%- assign _protected_content = _protected_content | append: "<script" | append: _script_split[0] | append: "</script>" -%}
      {%- comment -%} Komprimér resten {%- endcomment -%}
      {%- assign _after = _script_split[1] -%}
      {%- assign _compressed = _after | replace: '    ', ' ' | replace: '   ', ' ' | replace: '  ', ' ' -%}
      {%- assign _compressed = _compressed | replace: '> <', '><' | strip_newlines -%}
      {%- assign _protected_content = _protected_content | append: _compressed -%}
    {%- else -%}
      {%- assign _protected_content = _protected_content | append: "<script" | append: _part -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{%- assign _content = _protected_content -%}

{%- comment -%} Beskytt <pre> taggar {%- endcomment -%}
{%- assign _pre_parts = _content | split: "<pre" -%}
{%- assign _protected_content = "" -%}

{%- for _part in _pre_parts -%}
  {%- if forloop.first -%}
    {%- assign _protected_content = _protected_content | append: _part -%}
  {%- else -%}
    {%- assign _pre_split = _part | split: "</pre>" -%}
    {%- if _pre_split.size > 1 -%}
      {%- assign _protected_content = _protected_content | append: "<pre" | append: _pre_split[0] | append: "</pre>" | append: _pre_split[1] -%}
    {%- else -%}
      {%- assign _protected_content = _protected_content | append: "<pre" | append: _part -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{%- assign _content = _protected_content -%}

{%- comment -%} Beskytt <style> taggar {%- endcomment -%}
{%- assign _style_parts = _content | split: "<style" -%}
{%- assign _protected_content = "" -%}

{%- for _part in _style_parts -%}
  {%- if forloop.first -%}
    {%- assign _protected_content = _protected_content | append: _part -%}
  {%- else -%}
    {%- assign _style_split = _part | split: "</style>" -%}
    {%- if _style_split.size > 1 -%}
      {%- assign _protected_content = _protected_content | append: "<style" | append: _style_split[0] | append: "</style>" | append: _style_split[1] -%}
    {%- else -%}
      {%- assign _protected_content = _protected_content | append: "<style" | append: _part -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{{- _protected_content -}}